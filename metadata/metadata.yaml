version: 3
sources:
  - name: default
    kind: postgres
    configuration:
      connection_info:
        database_url:
          from_env: DATABASE_URL
        isolation_level: read-committed
        use_prepared_statements: true
    tables:
      - table:
          schema: public
          name: users
        array_relationships:
          - name: user_roles
            using:
              foreign_key_constraint_on:
                column: user_id
                table:
                  schema: public
                  name: user_roles
          - name: refresh_tokens
            using:
              foreign_key_constraint_on:
                column: user_id
                table:
                  schema: public
                  name: refresh_tokens
        select_permissions:
          - role: user
            permission:
              columns:
                - id
                - email
                - display_name
                - is_active
                - created_at
                - updated_at
              filter:
                id:
                  _eq: X-Hasura-User-Id
              limit: null
              allow_aggregations: false
      - table:
          schema: public
          name: roles
        array_relationships:
          - name: user_roles
            using:
              foreign_key_constraint_on:
                column: role_id
                table:
                  schema: public
                  name: user_roles
        select_permissions:
          - role: user
            permission:
              columns:
                - id
                - name
                - description
                - created_at
              filter:
                user_roles:
                  user_id:
                    _eq: X-Hasura-User-Id
              allow_aggregations: false
              limit: null
      - table:
          schema: public
          name: user_roles
        object_relationships:
          - name: user
            using:
              foreign_key_constraint_on: user_id
          - name: role
            using:
              foreign_key_constraint_on: role_id
        select_permissions:
          - role: user
            permission:
              columns:
                - user_id
                - role_id
                - assigned_at
              filter:
                user_id:
                  _eq: X-Hasura-User-Id
              allow_aggregations: false
              limit: null
      - table:
          schema: public
          name: refresh_tokens
        object_relationships:
          - name: user
            using:
              foreign_key_constraint_on: user_id

